<!DOCTYPE html>
<html>
  <head>
    <% include ../lib/bootstrap.v4.ejs %>
  </head>
  <body>
    <% include ../header/adminHeader.ejs %>
    <div class="container">
      <div class="pt-2">&nbsp;</div>
      <div class="row">
        <div class="col-2">
          <div class="list-group" id="sideNav">
            <a href="#addProductCate" class="list-group-item list-group-item-action">添加产品分类</a>
            <a href="#addProduct" class="list-group-item list-group-item-action">添加产品</a>
            <a href="#addNews" class="list-group-item list-group-item-action">添加新闻</a>
          </div>
        </div>
        <div class="col-10" id="content">
          <div class="alert text-center" role="alert" id="Tip">
            <!-- 提示的内容 -->
          </div>
          <a name="addProductCate">
            <div class="container-fluid">
              <h2 class="text-center">添加产品分类</h2>
              <div class="jumbotron">
                <form enctype="multipart/form-data" id="cateForm">
                  <div class="form-group row">
                    <label for="category" class="col-sm-2 col-form-label text-center">分类名:</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="category" placeholder="请输入分类名">
                    </div>
                  </div>
                  <button class="btn btn-primary float-right" id="addCate">确认</button>
                </form>
              </div>
            </div>
          </a>
          <a name="addProduct">
            <div class="container-fluid">
              <h2 class="text-center">添加产品</h2>
              <div class="jumbotron">
                <form enctype="multipart/form-data" id="proForm">
                  <div class="form-group row">
                    <label for="proTitle" class="col-sm-2 col-form-label text-center">标题:</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="proTitle" placeholder="请输入新闻标题">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="proCate" class="col-sm-2 col-form-label text-center">分类:</label>
                    <div class="col-sm-10">
                      <select class="form-control" id="proCate">
                        <option value="0">————请选择————</option>
                        <% for(let item in proCate){ %>
                        <option value="<%=proCate[item].id %>"><%=proCate[item].category %></option>
                        <% } %>
                      </select>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="proImg" class="col-sm-2 col-form-label text-center">图片:</label>
                    <div class="col-sm-10">
                      <input type="file" class="form-control" id="proImg" placeholder="请选择图片" accept="image/*">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="proContent" class="col-sm-2 col-form-label text-center">内容:</label>
                    <div class="col-sm-10">
                      <textarea rows="10" class="form-control" id="proContent"></textarea>
                    </div>
                  </div>
                  <button class="btn btn-primary float-right" id="addPro">确认</button>
                </form>
              </div>
            </div>
          </a>
          <a name="addNews">
            <div class="container-fluid">
              <h2 class="text-center">添加新闻</h2>
              <div class="jumbotron">
                <form enctype="multipart/form-data" id="newsForm">
                  <div class="form-group row">
                    <label for="title" class="col-sm-2 col-form-label text-center">标题:</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="title" placeholder="请输入新闻标题">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="date" class="col-sm-2 col-form-label text-center">日期:</label>
                    <div class="col-sm-10">
                      <input type="date" class="form-control" id="date" placeholder="请输入日期">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="img" class="col-sm-2 col-form-label text-center">图片:</label>
                    <div class="col-sm-10">
                      <input type="file" class="form-control" id="img" placeholder="请选择图片" accept="image/*">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="newsContent" class="col-sm-2 col-form-label text-center">内容:</label>
                    <div class="col-sm-10">
                      <textarea rows="10" class="form-control" id="newsContent"></textarea>
                    </div>
                  </div>
                  <button class="btn btn-primary float-right" id="addNews">确认</button>
                </form>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>
  </body>
</html>
<script>
  $(function(){
    $('#Tip').hide()
    //添加新闻
    $("#addNews").click(function(e){
      e.preventDefault();
      var fileList = $('#img')[0].files;
      var formData = new FormData();
      formData.append('img', fileList[0]);
      $('#Tip').show()
      if($("#title").val() == "" || $("#date").val() == "" || $("#newsContent").val() == ""){
        $("#Tip").text("请完善信息").addClass("alert-danger").fadeOut(3000,()=>{
          $("#Tip").removeClass("alert-danger").text("")
        })
        return false;
      }
      formData.append('news',JSON.stringify({
        title:$("#title").val(),
        date:$("#date").val(),
        newsContent:$("#newsContent").val(),
      }));
      $.ajax({
        url: '/admin/addNews',
        type:'post',
        processData:false,
        contentType:false,
        data: formData,
        success: function(data){
          if(data.code == 200){
            $("#Tip").text(data.msg).addClass("alert-success").fadeOut(3000,()=>{
              $("#Tip").removeClass("alert-success").text("")
            })
            document.querySelector("#newsForm").reset()
          }
        },
        error:function(){
          $("#Tip").text("添加失败").addClass("alert-danger").fadeOut(3000,()=>{
            $("#Tip").removeClass("alert-danger").text("")
          })
        }
      })
    }),
    //添加产品分类
    $("#addCate").click(function(e){
      e.preventDefault();
      $('#Tip').show()
      if(!$("#category").val()){
        $("#Tip").text("添加失败").addClass("alert-danger").fadeOut(3000,()=>{
          $("#Tip").removeClass("alert-danger").text("")
        });
        return false;
      }
      $.ajax({
        url: '/admin/addCate',
        type:'post',
        data: {category:$("#category").val()},
        success: function(data){
          if(data.code == 200){
            $("#Tip").text(data.msg).addClass("alert-success").fadeOut(3000,()=>{
              $("#Tip").removeClass("alert-success").text("")
            })
            document.querySelector("#cateForm").reset()
          }
        },
        error:function(){
          $("#Tip").text("添加失败").addClass("alert-danger").fadeOut(3000,()=>{
            $("#Tip").removeClass("alert-danger").text("");
          })
        }
      })
    })
    //添加产品
    $("#addPro").click(function(e){
      e.preventDefault();
      var fileList = $('#proImg')[0].files;
      var formData = new FormData();
      formData.append('proImg', fileList[0]);
      $('#Tip').show()
      if($("#proTitle").val() == "" || $("#proCate").val() == "0" || $("#proContent").val() == ""){
        $("#Tip").text("请完善信息").addClass("alert-danger").fadeOut(3000,()=>{
          $("#Tip").removeClass("alert-danger").text("")
        })
        return false;
      }
      formData.append('pro',JSON.stringify({
        proTitle:$("#proTitle").val(),
        proCate:$("#proCate").val(),
        proContent:$("#proContent").val(),
      }));
      $.ajax({
        url: '/admin/addPro',
        type:'post',
        processData:false,
        contentType:false,
        data: formData,
        success: function(data){
          if(data.code == 200){
            $("#Tip").text(data.msg).addClass("alert-success").fadeOut(3000,()=>{
              $("#Tip").removeClass("alert-success").text("")
            })
            document.querySelector("#proForm").reset()
          }
        },
        error:function(){
          $("#Tip").text("添加失败").addClass("alert-danger").fadeOut(3000,()=>{
            $("#Tip").removeClass("alert-danger").text("")
          })
        }
      })
    })
  })
</script>